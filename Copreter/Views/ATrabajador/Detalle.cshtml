@model IEnumerable<TTrabajador>

@{
  ViewData["Title"] = "Asignar Trabajador";
}

<section class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1>Asignar Trabajador en N°: @ViewBag.Cotizacion.IdCotizacion</h1>
      </div>
    </div>
  </div><!-- /.container-fluid -->
</section>

<section class="content">

  <div class="col-sm-12">
    <div class="card card-info">
      <div class="card-header">
        <h3 class="card-title">Ayudante</h3>
      </div>
    </div>
    @foreach (var trabajadores in Model.Where(x => x.IdTipoTrabajador == 2).ToList())
    {
      <div class="row" style="padding:0 5px 5%">
        <div class="col-6 col-sm-5">
          @trabajadores.Nombre , @trabajadores.Apellido con DNI: @trabajadores.Dni .
        </div>
        <div class="col-6 col-sm-1" style="display:flex">
          <a class="btn btn-primary" id="idAgregarPartida"
          onclick="addPartida(@trabajadores.Dni,'@trabajadores.Nombre',' @trabajadores.Apellido');" style="align-self:flex-end"><i
            class="fas fa-plus"></i></a>
        </div>
      </div>
    }
  </div>
  <hr />
  <div class="col-sm-12">
    <div class="card card-info">
      <div class="card-header">
        <h3 class="card-title">Capataz</h3>
      </div>
    </div>
    @foreach (var trabajadores in Model.Where(x => x.IdTipoTrabajador == 3).ToList())
    {
      <div class="row" style="padding:0 5px 5%">
        <div class="col-6 col-sm-5">
          @trabajadores.Nombre , @trabajadores.Apellido con DNI: @trabajadores.Dni .
        </div>
        <div class="col-6 col-sm-1" style="display:flex">
          <a class="btn btn-primary" id="idAgregarPartida"
          onclick="addPartida(@trabajadores.Dni,'@trabajadores.Nombre',' @trabajadores.Apellido');" style="align-self:flex-end"><i
            class="fas fa-plus"></i></a>
        </div>
      </div>
    }
  </div>
  <hr />
  <table id="partidasAgregadas" class="table">
    <thead class="thead-light">
      <tr>
        <th scope="col">N° DNI</th>
        <th scope="col">Nombre Trabajador</th>
        <th scope="col">Apellido Trabajador</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <br />
  <br />
  <div style="text-align: end; margin: 4px;">
    <button type="submit" style="width:10%" class="btn btn-info" onclick="AgregarCotizacion('@ViewBag.Cotizacion.IdCotizacion')">Asignar</button>
  </div>
</section>
@section scripts{
<script>
  var partidasxObra = [];
  function addPartida(DniTrabajador, nombre,apellido) {
    console.log("exito");
    var row = "<tr>" +
      "<td>" + DniTrabajador + "</td>" +
      "<td>" + nombre + "</td>" +
      "<td>" + apellido + "</td>" +
      "</tr>";
    $('#partidasAgregadas > tbody').append(row);
  }

 
  function AgregarCotizacion(IdCotizacion)
  {
    var row = document.getElementById('partidasAgregadas').rows.length;
    var partida = new Object();
    partida.IdCotizacion = IdCotizacion;
    for (i = 1; i < row; i++) {
        var parti = new Object();
        parti.IdCotizacion = IdCotizacion;
          parti.DniTrabajador = document.getElementById("partidasAgregadas").rows[i].cells.item(0).innerHTML;
        partidasxObra.push(parti);
    }
    partida.TTrabajadorxCotizacions = partidasxObra;
    $.ajax({
        type: 'post',
        url: 'https://localhost:5001/ATrabajador/Agregar',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(partida),
        dataType: "json",
        success: function (data, textStatus, jqXHR) {
          console.log("exito");
          location.href = "https://localhost:5001/Cotizar/ListarAdmin"
        }
    });
  }
</script>
}

